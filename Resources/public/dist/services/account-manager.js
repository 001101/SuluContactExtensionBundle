define(["services/sulucontact/account-manager","services/husky/util","services/husky/mediator","sulucontactextension/models/termsOfPayment","sulucontactextension/models/termsOfDelivery","sulucontact/models/account"],function(a,b,c,d,e,f){"use strict";function g(){}var h=null,i=function(a){if(a&&"function"!=typeof a)throw"callback is not a function";c.emit("sulu.overlay.show-warning","sulu.overlay.be-careful","contact.accounts.type.conversion.message",a.bind(this,!1),a.bind(this,!0))};return g.prototype=a,g.prototype.constructor=a,g.prototype.deleteTerms=function(a,f){var g,h,i;f&&f.length>0&&("delivery"===a?(h=e,i="terms-of-delivery"):"payment"===a&&(h=d,i="terms-of-payment"),b.each(f,function(a,b){g=h.findOrCreate({id:b}),g.destroy({error:function(){c.emit("husky.select."+i+".revert")}.bind(this)})}.bind(this)))},g.prototype.saveTerms=function(a,d){var e,f;d&&d.length>0&&("delivery"===a?(f="termsofdeliveries",e="terms-of-delivery"):"payment"===a&&(f="termsofpayments",e="terms-of-payment"),b.save("/admin/api/"+f,"PATCH",d).then(function(a){c.emit("husky.select."+e+".update",a,null,!0)}.bind(this)).fail(function(){c.emit("husky.select."+e+".save.revert")}.bind(this)))},g.prototype.saveFinancials=function(a){var b=f.findOrCreate({id:a.id}),g=$.Deferred();return b.set(a),a.termsOfPayment&&b.set("termsOfPayment",d.findOrCreate({id:a.termsOfPayment})),a.termsOfDelivery&&b.set("termsOfDelivery",e.findOrCreate({id:a.termsOfDelivery})),b.save(null,{patch:!0,success:function(a){var b=a.toJSON();g.resolve(a),c.emit("sulu.contacts.accounts.financials.saved",b)}.bind(this)}),g},g.prototype.convertAccount=function(a,d){var e=$.Deferred();return i.call(this,function(g){if(g){var h=f.findOrCreate({id:a});h.set({type:d.id}),b.ajax("/admin/api/accounts/"+a+"?action=convertAccountType&type="+d.name,{type:"POST",success:function(a){var b=a;c.emit("sulu.contacts.accounts.saved",b),e.resolve(b)}.bind(this)})}else e.resolve(null)}.bind(this)),e},g.getInstance=function(){return null===h&&(h=new g),h},g.getInstance()});