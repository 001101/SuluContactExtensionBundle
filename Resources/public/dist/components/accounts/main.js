define(["accountsutil/header","sulucontactextension/model/termsOfPayment","sulucontactextension/model/termsOfDelivery","sulucontact/components/accounts/main"],function(a,b,c,d){"use strict";var e,f=function(){},g=function(){},h=function(a){i.call(this,function(b){b&&(this.account.set({type:a.id}),this.sandbox.emit("sulu.header.toolbar.item.loading","options-button"),this.sandbox.util.ajax("/admin/api/accounts/"+this.account.id+"?action=convertAccountType&type="+a.name,{type:"POST",success:function(a){var b=a;this.sandbox.emit("sulu.header.toolbar.item.enable","options-button"),this.sandbox.emit("sulu.contacts.accounts.saved",b),this.setHeader(),this.sandbox.emit("sulu.account.type.converted")}.bind(this),error:function(){this.sandbox.logger.log("error while saving profile")}.bind(this)}))}.bind(this))},i=function(a){if(a&&"function"!=typeof a)throw"callback is not a function";this.sandbox.emit("sulu.overlay.show-warning","sulu.overlay.be-careful","contact.accounts.type.conversion.message",a.bind(this,!1),a.bind(this,!0))},j=function(a,d){var e,f,g;d&&d.length>0&&("delivery"===a?(f=c,g="terms-of-delivery"):"payment"===a&&(f=b,g="terms-of-payment"),this.sandbox.util.each(d,function(a,b){e=f.findOrCreate({id:b}),e.destroy({error:function(){this.sandbox.emit("husky.select."+g+".revert")}.bind(this)})}.bind(this)))},k=function(a,b){var c,d;b&&b.length>0&&("delivery"===a?(d="termsofdeliveries",c="terms-of-delivery"):"payment"===a&&(d="termsofpayments",c="terms-of-payment"),this.sandbox.util.save("/admin/api/"+d,"PATCH",b).then(function(a){this.sandbox.emit("husky.select."+c+".update",a,null,!0)}.bind(this)).fail(function(a,b){this.sandbox.emit("husky.select."+c+".save.revert"),this.sandbox.logger.error(a,b)}.bind(this)))},l=function(a){this.sandbox.emit("sulu.header.toolbar.item.loading","save-button"),this.account.set(a),a.termsOfPayment&&this.account.set("termsOfPayment",b.findOrCreate({id:a.termsOfPayment})),a.termsOfDelivery&&this.account.set("termsOfDelivery",c.findOrCreate({id:a.termsOfDelivery})),this.account.save(null,{patch:!0,success:function(a){var b=a.toJSON();this.sandbox.emit("sulu.contacts.accounts.financials.saved",b)}.bind(this),error:function(){this.sandbox.logger.log("error while saving profile")}.bind(this)})};return f.prototype=d,f.prototype.constructor=f,e=new f,g.prototype=new f,g.prototype.constructor=g,g.prototype.accountType=null,g.prototype.accountTypes=null,g.prototype.bindCustomEvents=function(){e.bindCustomEvents.call(this),this.sandbox.on("sulu.contacts.account.types",function(a){this.accountType=a.accountType,this.accountTypes=a.accountTypes}.bind(this)),this.sandbox.on("sulu.contacts.account.get.types",function(a){"function"==typeof a&&a(this.accountType,this.accountTypes)}.bind(this)),this.sandbox.on("sulu.contacts.account.convert",function(a){h.call(this,a)}.bind(this)),this.sandbox.on("husky.select.terms-of-delivery.delete",j.bind(this,"delivery")),this.sandbox.on("husky.select.terms-of-payment.delete",j.bind(this,"payment")),this.sandbox.on("husky.select.terms-of-delivery.save",k.bind(this,"delivery")),this.sandbox.on("husky.select.terms-of-payment.save",k.bind(this,"payment")),this.sandbox.on("sulu.contacts.accounts.financials.save",l.bind(this))},g.prototype.bindSidebarEvents=function(){e.bindSidebarEvents.call(this),this.sandbox.dom.on("#sidebar","click",function(a){var b=this.sandbox.dom.data(a.currentTarget,"id");this.sandbox.emit("sulu.router.navigate","contacts/accounts/edit:"+b+"/details"),this.sandbox.emit("husky.navigation.select-item","contacts/accounts")}.bind(this),".subsidiary-account")},g.prototype.renderList=function(){var a=this.sandbox.dom.createElement('<div id="accounts-list-container"/>');this.html(a),this.sandbox.start([{name:"accounts/components/list@sulucontact",options:{el:a,accountType:this.options.accountType?this.options.accountType:null}}])},g.prototype.setHeader=function(){a.setHeader.call(this,this.account,this.options.accountType)},g.prototype.renderCreateForm=function(b,c){var d=a.getAccountTypeIdByTypeName.call(this,this.options.accountType);this.account.set({type:d}),this.sandbox.start([{name:"accounts/components/form@sulucontact",options:{el:c,data:this.account.toJSON()}}]),b.resolve()},g.prototype.add=function(a){this.sandbox.emit("sulu.router.navigate","contacts/accounts/add/type:"+a)},g.prototype.renderByDisplay=function(){"financials"===this.options.display?this.renderComponent("accounts/components/",this.options.display,"accounts-form-container",{},"sulucontactextension").then(this.setHeader.bind(this)):e.renderByDisplay.call(this)},g.prototype.navigateToList=function(a,b){var c="";if(a.type)for(var d in this.accountTypes)if(this.accountTypes[d].id===a.type){c="/type:"+d;break}this.sandbox.emit("sulu.router.navigate","contacts/accounts"+c,!b,!0,!0)},new g});